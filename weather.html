<!DOCTYPE html>
<html>
  <head>
    <title>My Weather Page</title>
    <script
      src="http://code.jquery.com/jquery-3.2.1.min.js">
    </script>
  </head>

  <body>
    <h1>Something very important is going to go here...</h1>
    <p>Please enter the name of the city you would like to query</p>
    <form>
      City name:<br>
      <input id="cityText" type="text" name="firstname" value=""> <br>
      <input id="submitButton" type="submit" value="Go!"><br>
      Suggestions:<br><span id="txtHint">Empty</span>
    </form>
    <textarea id="selectedCity">No City</textarea>
  </body>
</html>

<script>
  $(document).ready(function() {
    $( "#cityText" ).keyup(function() {
      var parameter = 'http://bioresearch.byu.edu/cs260/jquery/getcity.cgi?q=';
      parameter += $("#cityText").val();
      $.getJSON(parameter,function(data) {
        var everything;
        everything = "<ul>";
        $.each(data, function(i,item) {
          everything += "<li> "+data[i].city;
        });
        everything += "</ul>";
        $("#txtHint").html(everything);
      })
      .done(function() { console.log('getJSON request succeeded!'); })
      .fail(function(jqXHR, textStatus, errorThrown) {
        console.log('getJSON request failed! ' + textStatus);
        console.log("incoming "+jqXHR.responseText);
      })
      .always(function() { console.log('getJSON request ended!');
      });
    });
    $("#submitButton").click(function(e){
      var value = $("#cityText").val();
      console.log(value);
      e.preventDefault();
      $("#selectedCity").text(value);
      //insert API call here:
      var url = 'https://api.openweathermap.org/data/2.5/weather?units=imperial&appid=e71d46c042a3ed66257ef2341b635893&q=';
      url += value;
      $.getJSON(url,function(data) {
        console.log('Results of JSON fetch next');
        console.log(data);
        var everything;
        everything = "<ul>";
        $.each(data, function(i,item) {
          everything += "<li> "+data[i].city;
        });
        everything += "</ul>";
        $("#txtHint").html(everything);
      })
      .done(function() { console.log('getJSON request succeeded!'); })
      .fail(function(jqXHR, textStatus, errorThrown) {
        console.log('getJSON request failed! ' + textStatus);
        console.log("incoming "+jqXHR.responseText);
      })
      .always(function() { console.log('getJSON request ended!');
      });
    });
  });
</script>
